(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(e,t,n){e.exports={notFound:"Dashboard_notFound__1qL1D",schemaHeading:"Dashboard_schemaHeading__34UYH"}},15:function(e,t,n){e.exports={switch:"LabelSwitch_switch__1K3Vg",disabledSwitch:"LabelSwitch_disabledSwitch__1stGN"}},16:function(e,t,n){e.exports={input:"EditableLabel_input__1OQfg"}},26:function(e,t,n){e.exports=n(49)},27:function(e,t,n){},29:function(e,t,n){},35:function(e,t,n){},43:function(e,t,n){},46:function(e,t,n){},49:function(e,t,n){"use strict";n.r(t);n(27),n(29);var a=n(1),i=n(10),o=n(4),r=(n(35),n(53)),s=n(5),c=n(3),l=function(){function e(){}return e.prototype.getPins=function(e,t,n){this.callGraphql("\nquery{\n\tpins"+(void 0===n?"":"(schema:"+n+")")+"{\n\t\tid\n\t\tname\n\t\tdefault:defaultActive\n\t}\n}\n",function(t){return e(t.pins.sort(function(e,t){return e.id>t.id?1:-1}))},t)},e.prototype.getPinModes=function(e,t,n){this.callGraphql("\nquery{\n  schema(id:"+n+"){\n    id\n    pinmodes:pins{\n      mode\n      pin{\n        id\n        name\n      }\n    }\n  }\n}\n",function(t){return e(t.schema[0].pinmodes.sort(function(e,t){return e.id>t.id?1:-1}))},t)},e.prototype.editPins=function(e,t,n,a){this.callGraphql("mutation{\n  editPin(id:"+e+', name:"'+t+'"){\n    id\n    name\n  }\n}',n,a)},e.prototype.setPinDefaultState=function(e,t,n,a){this.callGraphql("mutation{\n  setPinDefaultState(id:"+e+", mode:"+t+"){\n    id\n    name\n  }\n}",n,a)},e.prototype.getSchemas=function(e,t,n){this.callGraphql("\nquery{\nschema"+(n?"(active:true)":"")+"{\n\tname\n\tid\n\tactive\n\t"+(n?"pins{\n      mode\n      pin{\n        id\n        name\n      }\n    }":"")+"\n}\n}\n",function(t){return e(t.schema.sort(function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()?1:-1}))},t)},e.prototype.createSchema=function(e,t,n,a){this.callGraphql('\nmutation{\n  schema:createSchema(\n    name:"'+e+'"\n    mode:['+t.map(function(e){return"{pinid:"+e.pin.id+",mode:"+e.mode+"}, "})+"]\n  ){\n    name\n  }\n}\n",n,a)},e.prototype.activateSchema=function(e,t,n){this.callGraphql("\nmutation{\n activateSchema(id:"+e+"){\n  name\n  id\n  active\n}\n}\n",t,n)},e.prototype.editSchema=function(e,t,n,a,i){this.callGraphql("\nmutation{\n  schema:editSchema(\n    id:"+e+'\n    name:"'+t+'"\n    mode:['+n.map(function(e){return"{pinid:"+e.pin.id+",mode:"+e.mode+"}, "})+"]\n  ){\n    name\n  }\n}\n",a,i)},e.prototype.editSchemaName=function(e,t,n,a){this.callGraphql("\nmutation{\n  schema:editSchemaName(\n    id:"+e+'\n    name:"'+t+'"\n  ){\n    name\n  }\n}\n',n,a)},e.prototype.deleteSchema=function(e,t,n){this.callGraphql("\nmutation{\n  deleteSchema(id:"+e+"){\n    name\n    id\n  }\n}\n",t,n)},e.prototype.login=function(e,t,n,a){this.callGraphql('\nmutation{\n login(user:"'+e+'", password:"'+t+'")\n}\n',function(e){document.cookie="session="+e.login+"; expires=0; path=/",n()},a)},e.prototype.isLoggedIn=function(){return null!==this.getCookieValue("session")},e.prototype.getCookieValue=function(e){var t=document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)");if(t){var n=t.pop();return"null"===n?null:n}return null},e.prototype.deleteCookie=function(e){document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"},e.prototype.callGraphql=function(e,t,n){var a=this;fetch("http://localhost:9000/graphql",{method:"post",body:JSON.stringify({query:e}),headers:new Headers({"Content-Type":"application/json",Authorization:"Bearer "+this.getCookieValue("session")})}).then(function(e){return e.json()}).then(function(e){void 0!==e.errors?"Permission not granted"===e.errors[0].message?(a.deleteCookie("session"),window.history.pushState({},"","/login")):n(e.errors[0].message):t(e.data)}).catch(function(e){return n(e.message)})},e}(),u=n(15),m=n.n(u),d=function(e){function t(t,n){var a=e.call(this,t,n)||this;return a.state={index:t.defaultindex||0,defaultindex:t.defaultindex||0,disabled:void 0!==a.props.disabled&&a.props.disabled},a.onSave=a.onSave.bind(a),a.onClick=a.onClick.bind(a),a}return o.b(t,e),t.prototype.render=function(){return a.createElement("div",{title:this.state.disabled?"":this.props.tooltip||"",onClick:this.onClick,className:this.state.disabled?m.a.disabledSwitch:m.a.switch,onMouseOut:this.onSave},this.props.switchlist[this.state.index][0])},t.prototype.onClick=function(e){this.state.disabled||this.setState({index:this.state.index+1<this.props.switchlist.length?this.state.index+1:0})},t.prototype.onSave=function(){this.state.disabled||this.state.index===this.state.defaultindex||(this.setState({defaultindex:this.state.index}),this.props.onChange(this.props.switchlist[this.state.index][1]))},t}(a.Component),h=n(16),p=n.n(h),f=function(e){function t(t,n){var a=e.call(this,t,n)||this;return a.state={value:t.value||"",defaultvalue:t.value||""},a.onChange=a.onChange.bind(a),a}return o.b(t,e),t.prototype.render=function(){var e=this;return this.props.disabled?a.createElement("div",{className:p.a.input},this.state.value," "):a.createElement("input",{className:p.a.input,value:this.state.value,onChange:function(t){return e.setState({value:t.target.value})},onKeyPress:this.onChange,onBlur:function(t){e.state.defaultvalue!==t.target.value&&(e.setState({defaultvalue:t.target.value}),e.props.onSumbit(t.target.value))}})},t.prototype.onChange=function(e){9!==e.which&&13!==e.which||e.target.blur()},t}(a.Component),v=function(e){function t(t){var n=e.call(this,t)||this;return n.state={pins:[void 0]},n.backend=new l,n.backend.getPins(function(e){return n.setState({pins:e})},function(e){return console.error(e)}),n.saveName=n.saveName.bind(n),n}return o.b(t,e),t.prototype.render=function(){var e=this;return a.createElement(c.d,null,a.createElement("br",null),a.createElement("h1",null,"Pins"),a.createElement("br",null),a.createElement(c.l,null,a.createElement(c.m,null,a.createElement("tbody",null,a.createElement("tr",null,a.createElement("th",null,"Id"),a.createElement("th",null,"Name"),a.createElement("th",null,"Default Setting")),this.state.pins.filter(function(e){return void 0!==e&&null!==e}).map(function(t){return a.createElement("tr",{key:t.id},a.createElement("td",null,t.id),a.createElement("td",null,a.createElement(f,{value:t.name,onSumbit:function(n){return e.saveName(t.id,n)}})),a.createElement("td",null,a.createElement(d,{tooltip:"Click to change",switchlist:[["Active","true"],["Deactivated","false"]],onChange:function(n){return e.saveDefaultState(t.id,n)}})))})))))},t.prototype.saveName=function(e,t){this.backend.editPins(e,t,function(){return s.success("The changes have successfully been saved.")},this.onError)},t.prototype.onError=function(e){s.error("Change could not be made permanently. "+e)},t.prototype.saveDefaultState=function(e,t){this.backend.setPinDefaultState(e,"true"===t,function(){return s.success("The changes have successfully been saved.")},this.onError)},t}(a.Component),g=(n(43),n(24)),E=n.n(g),b=n(11),y=n.n(b),S=function(e){function t(t){var n=e.call(this,t)||this;return n.backend=new l,n.state={pins:[void 0],modified:!1},t.schema?n.backend.getPinModes(function(e){return n.setState({pins:e})},n.onError,t.schema):n.backend.getPins(function(e){return n.setState({pins:n.convertToDefaultMode(e)})},n.onError),n}return o.b(t,e),t.prototype.componentWillReceiveProps=function(e,t){e.saveNow&&this.state.modified&&(this.setState({modified:!1}),this.props.onSave(this.props.schema,this.state.pins))},t.prototype.render=function(){var e=this;return a.createElement(c.d,null,a.createElement(c.l,null,a.createElement(c.m,null,a.createElement("tbody",null,a.createElement("tr",null,a.createElement("th",null,"Pinnumber"),a.createElement("th",null,"Name"),a.createElement("th",null,"Setting")),this.state.pins.filter(function(e){return void 0!==e&&null!==e}).sort(function(e,t){return e.pin.id>t.pin.id?1:-1}).map(function(t){return a.createElement("tr",{key:t.pin.id},a.createElement("td",null,t.pin.id),a.createElement("td",null,t.pin.name),a.createElement("td",null,a.createElement(d,{defaultindex:t.mode,tooltip:"Click to change",switchlist:[["deactivated","0"],["active","1"],["unmodified","2"]],onChange:function(n){return e.saveState(t.pin.id,n)}})))})))))},t.prototype.convertToDefaultMode=function(e){for(var t=[],n=0;n<e.length;n++)t[n]={mode:2,pin:e[n]};return t},t.prototype.saveState=function(e,t){var n=this.state.pins,a=n.splice(n.findIndex(function(t){return t.pin.id===e}),1)[0].pin;n.push({mode:+t,pin:a}),this.setState({pins:n,modified:!0})},t.prototype.onError=function(e){console.error(e),s.error("Change could not be made permanently. "+e)},t}(a.Component),w=function(e){function t(t){var n=e.call(this,t)||this;return n.state={modal:!1},n.toggle=n.toggle.bind(n),n}return o.b(t,e),t.prototype.render=function(){var e=this;return a.createElement("div",null,a.createElement("div",{className:this.props.className,onClick:this.toggle},this.props.buttonLabel),a.createElement(c.e,{isOpen:this.state.modal,toggle:this.toggle},a.createElement(c.h,{toggle:this.toggle},this.props.title),a.createElement(c.f,null,this.props.children),a.createElement(c.g,null,a.createElement(c.b,null,a.createElement(c.a,{color:"primary",onClick:function(){e.toggle(),e.props.onSubmit()}},this.props.submitText||"Ok"),a.createElement(c.a,{color:"secondary",onClick:this.toggle},this.props.cancelText||"Cancel")))))},t.prototype.toggle=function(){this.setState({modal:!this.state.modal})},t}(a.Component),N=function(e){function t(t){var n=e.call(this,t)||this;return n.backend=new l,n.state={schema:void 0,hoverindex:-1,saveNow:!1,schemaname:""},n.getSchemas(),n.getSchemas=n.getSchemas.bind(n),n.saveName=n.saveName.bind(n),n.saveNewSchema=n.saveNewSchema.bind(n),n.saveEditedPins=n.saveEditedPins.bind(n),n}return o.b(t,e),t.prototype.render=function(){var e=this;return a.createElement(c.d,null,a.createElement("h1",{className:"h1"},"Schemas"),a.createElement("div",{className:"text-right"},a.createElement(w,{className:"btn btn-primary add-button",title:"Add a new schema",buttonLabel:"Add schema",onSubmit:function(){return e.setState({saveNow:!0})}},a.createElement("input",{placeholder:"Name",className:"form-control",onChange:function(t){return e.setState({schemaname:t.target.value})}}),a.createElement(S,{saveNow:this.state.saveNow,onSave:this.saveNewSchema}))),a.createElement(E.a,null,void 0===this.state.schema||this.state.schema.length<1?a.createElement("div",{className:y.a.notFound},"No schemas found"):a.createElement("div",{className:"w-100"},a.createElement(c.m,null,a.createElement("tbody",null,a.createElement("tr",null,a.createElement("th",null,"Id"),a.createElement("th",null,"Name"),a.createElement("th",null,"Setting"),a.createElement("th",null),a.createElement("th",null)),this.state.schema.map(function(t){return a.createElement("tr",{key:t.id,className:"schemaview"},a.createElement("td",null,t.id),a.createElement("td",null,a.createElement(f,{value:t.name,onSumbit:function(n){return e.saveName(t.id,n)}})),a.createElement("td",null,a.createElement(d,{disabled:t.active,key:t.active+"",defaultindex:t.active?0:1,tooltip:"Click to change",switchlist:[["Active",!0],["Deactivated",!1]],onChange:function(n){return e.setSchemaActive(t.id,n)}})),a.createElement("td",{className:"text-right"},a.createElement(w,{className:"btn btn-danger hoverbutton float-right radius-right",submitText:"Yes",title:"Delete the following element?",buttonLabel:"Delete",onSubmit:function(){return e.deleteSchema(t.id)}},a.createElement("h3",null,t.name)),a.createElement(w,{className:"btn btn-warning hoverbutton float-right radius-left",title:t.name,buttonLabel:"Edit",onSubmit:function(){return e.setState({saveNow:!0})},submitText:"Save"},a.createElement(S,{schema:t.id,saveNow:e.state.saveNow,onSave:e.saveEditedPins}))))}))))))},t.prototype.getSchemas=function(){var e=this;this.backend.getSchemas(function(t){return e.setState({schema:t})},this.onError)},t.prototype.saveNewSchema=function(e,t){var n=this;0!==this.state.schemaname.trim().length?(this.setState({saveNow:!1}),this.backend.createSchema(this.state.schemaname,t,function(){s.success("The changes have successfully been saved."),n.getSchemas()},this.onError)):s.error("The schema name needs to be set.")},t.prototype.saveName=function(e,t){var n=this;this.backend.editSchemaName(e,t,function(){s.success("The schema was successfully updated."),n.getSchemas()},this.onError)},t.prototype.setSchemaActive=function(e,t){var n=this;t&&this.backend.activateSchema(e,function(){s.success("The schema was successfully activated."),n.getSchemas()},this.onError)},t.prototype.deleteSchema=function(e){var t=this;this.backend.deleteSchema(e,function(){s.success("The schema was successfully deleted."),t.getSchemas()},this.onError)},t.prototype.saveEditedPins=function(e,t){var n=this;this.backend.editSchema(e,this.state.schema[0].name,t,function(){s.success("The schema was successfully updated."),n.getSchemas()},this.onError)},t.prototype.onError=function(e){s.error("Couldn't save changes. "+e)},t}(a.Component),k=function(e){function t(t){var n=e.call(this,t)||this;return n.state={modepins:void 0,name:""},n.backend=new l,n.backend.getSchemas(function(e){return n.setState({name:e.length<1?"":e[0].name,modepins:e.length<1?void 0:e[0].pins})},n.onError,!0),n.saveName=n.saveName.bind(n),n}return o.b(t,e),t.prototype.render=function(){return a.createElement(c.d,null,a.createElement(c.l,null,this.state.modepins?a.createElement("div",{className:"w-100"},a.createElement("div",{className:y.a.schemaHeading},"Active schema ",this.state.name),a.createElement(c.m,null,a.createElement("tbody",null,a.createElement("tr",null,a.createElement("th",null,"Pinnumber"),a.createElement("th",null,"Name"),a.createElement("th",null,"Setting")),this.state.modepins.sort(function(e,t){return e.pin.id>t.pin.id?1:-1}).map(function(e){return a.createElement("tr",{key:e.pin.id},a.createElement("td",null,e.pin.id),a.createElement("td",null,a.createElement(f,{disabled:!0,value:e.pin.name,onSumbit:function(){return null}})),a.createElement("td",null,a.createElement(d,{defaultindex:0===e.mode?1:0,disabled:!0,switchlist:[["Active","true"],["Deactivated","false"]],onChange:function(){return null}})))})))):a.createElement("div",{className:y.a.notFound},"No active schema found")))},t.prototype.saveName=function(e,t){this.backend.editPins(e,t,function(){return s.success("The changes have been successfully saved.")},this.onError)},t.prototype.onError=function(e){s.error("Change could not be made permanently. "+e)},t}(a.Component),C=n(54),x=n(55),P=n(56),L=n(50),T=(n(46),function(e){function t(t){var n=e.call(this,t)||this;return n.backend=new l,n.login=n.login.bind(n),n.state={isLoggedIn:n.backend.isLoggedIn()},n}return o.b(t,e),t.prototype.render=function(){return this.state.isLoggedIn?(this.handleNavbar(!1),a.createElement(L.a,{to:"/"})):a.createElement("div",{id:"LoginForm"},a.createElement("div",{className:"container"},a.createElement("h1",{className:"form-heading"},"Login"),a.createElement("div",{className:"login-form"},a.createElement("div",{className:"main-div"},a.createElement("form",{id:"Login",onSubmit:this.login},a.createElement("div",{className:"form-group"},a.createElement("input",{required:!0,className:"form-control",id:"inputEmail",placeholder:"User"})),a.createElement("div",{className:"form-group"},a.createElement("input",{required:!0,type:"password",className:"form-control",id:"inputPassword",placeholder:"Password"})),a.createElement("button",{type:"submit",className:"btn btn-primary"},"Login"))))))},t.prototype.componentDidMount=function(){this.handleNavbar(this.state.isLoggedIn)},t.prototype.componentDidUpdate=function(e,t,n){this.setState({isLoggedIn:this.backend.isLoggedIn()}),this.handleNavbar(this.state.isLoggedIn)},t.prototype.handleNavbar=function(e){document.getElementById("navbar").setAttribute("style","display:"+(e?"visible":"none"))},t.prototype.login=function(e){var t=this;e.preventDefault(),e.stopPropagation(),e.currentTarget.checkValidity(),this.backend.login(e.currentTarget[0].value,e.currentTarget[1].value,function(){return t.setState({isLoggedIn:!0})},this.onError)},t.prototype.onError=function(e){s.error("Couldn't save changes. "+e)},t}(a.Component)),q=n(52),D=function(e){var t,n=e.component,i=o.c(e,["component"]);return a.createElement(P.a,o.a({},i,{render:(t=n,function(e){return t?(new l).isLoggedIn()?a.createElement(t,o.a({},e)):a.createElement(q.a,{to:{pathname:"/login",state:{from:e.location}}}):null})}))},I=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.b(t,e),t.prototype.render=function(){return a.createElement(C.a,null,a.createElement("div",{style:{minHeight:"100vh"}},this.props.children,a.createElement(x.a,null,a.createElement(D,{exact:!0,path:"/",component:k}),a.createElement(D,{exact:!0,path:"/pins",component:v}),a.createElement(D,{exact:!0,path:"/schema",component:N}),a.createElement(P.a,{exact:!0,path:"/login",component:T}),a.createElement(P.a,{component:T}))))},t}(a.Component),_=n(25),G=n.n(_),A=function(e){function t(t){var n=e.call(this,t)||this;return n.toggle=n.toggle.bind(n),n.state={isOpen:!1},n}return o.b(t,e),t.prototype.render=function(){return a.createElement(I,null,a.createElement("div",{id:"navbar"},a.createElement(c.j,{color:"primary",light:!0,expand:"md"},a.createElement(r.a,{className:"navbar-brand",to:"/"},"HeizungsPi"),a.createElement(c.k,{onClick:this.toggle}),a.createElement(c.c,{isOpen:this.state.isOpen,navbar:!0},a.createElement(G.a,{className:"ml-auto",navbar:!0},a.createElement(c.i,null,a.createElement(r.a,{className:"nav-link",to:"/pins"},"Pins")),a.createElement(c.i,null,a.createElement(r.a,{className:"nav-link",to:"/schema"},"Schema")))))))},t.prototype.toggle=function(){this.setState({isOpen:!this.state.isOpen})},t}(a.Component),O=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function H(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}i.render(a.createElement(A,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="/service-worker.js";O?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):H(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):H(e)})}}()}},[[26,2,1]]]);
//# sourceMappingURL=main.6ad857b7.chunk.js.map